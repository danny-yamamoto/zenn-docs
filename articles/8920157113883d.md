---
title: "TypeError: 'async_generator' object is not iterable"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

## tl;dr

## コンテキスト
AI エージェントの導入に向けて検証を行なっている
限定公開に向けて Gemini Enterprise（以降、Gemini）を利用している

## 事象
11月14日あたりに Gemini で Custom Agent（Agent Engine Runtime 上のエージェント）を起動すると「質問への回答中にエラーが発生しました。しばらくしてからもう一度お試しください。」というエラーメッセージが表示された
Agent Engine のプレイグラウンドでは正常に動作している

## 原因
既知の問題だった
Gemini と ADK/Agent Engine の互換性の問題だった
サポートの回答は以下の通り
> I have found that this is a known issue and the product team is currently working on the issue. In the meantime you can use the older version of the library ‘google-cloud-aiplatform[adk,agent_engines]’ i.e 1.126.1. This should resolve the issue you are currently facing. 

## 対策
フィードバックの通りライブラリのバージョンを 1.126.1 にダウングレードした
```python
        requirements=[
            "google-adk>=1.15.1",
            "google-cloud-aiplatform[adk]==1.126.1",
        ],
```

## Closing
ハンドルは自分で握る
要するに何かを提供するためにはある程度のコントロールが必要ということだ
今回は Gemini の問題だったが、今後も同様の問題が起こる可能性があるため、プラットフォームとの連携には注意が必要だ
