---
title: "Learn to compare AWS and Google Cloud: About ECS"
emoji: "ğŸŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "rds", "cloudrun", "ecs", "rust"]
published: true
---
![foodcourt](/images/188563c93c3a2a-a.jpeg)

Amazon Elastic Container Service (ECS) [^1] ã«ã¤ã„ã¦ã€‚

å‰è·ã§ä½¿ç”¨ã—ã¦ã„ãŸ Google Cloud ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨é–¢é€£ä»˜ã‘ãªãŒã‚‰å­¦ã¶ã€‚

ECS ã¯ã»ã¨ã‚“ã©è§¦ã£ãŸã“ã¨ãŒãªã‹ã£ãŸã€‚

ECS ã®è¨­å®šå‘¨ã‚Šã¨ RDS ã¸ã®ã®æ¥ç¶šã«ã¤ã„ã¦å­¦ã¶ã€‚

```mermaid
flowchart TD
    cb["CodeBuild"]
    ecr["ECR"]
    docker["Amazon ECR Public Gallery Docker"]
    ecs["ECS"]
    gh["GitHub"]
    rds["RDS"]
    cb --  push --> ecr
    docker -- pull --> cb
    ecr -- pull --> ecs
    gh -- clone --> cb
    ecs -- fetch --> rds
```

## tl;dr
- Rust ã® App ã‚’ ECS Fargate ã§å‹•ã‹ã—ãŸã€‚
- AWS ã‚’åˆ©ç”¨ã™ã‚‹ä¸Šã§ã¯ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚°ãƒ«ãƒ¼ãƒ—ã€ãŒé‡è¦ã ã¨æ€ã†ã€‚ã‚µãƒ¼ãƒ“ã‚¹é–“ã® inbound/outbound ã‚’æ­£ã—ãç†è§£ã™ã‚‹ã“ã¨ã€‚
- ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚°ãƒ«ãƒ¼ãƒ—ã€ã¯ Google Cloud ã® Firewall ã¨åŒã˜ä½ç½®ä»˜ã‘ã«ãªã‚‹ã¨æ€ã†ã€‚ãã‚Œã¨ IAM ãŒå¿…è¦ã€‚

## About CodeBuild
![alt text](/images/188563c93c3a2a-c.png)
- Cloud Build ã«ä¼¼ãŸã‚µãƒ¼ãƒ“ã‚¹ã€‚
- `buildspec.yml` ã‚’å®šç¾©ã€‚Cloud Build ã®ãƒ“ãƒ«ãƒ‰æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ« [^6] ã®ã‚ˆã†ãªã€‚

https://github.com/danny-yamamoto/rust-api-samples-axum/blob/main/buildspec.yml

|Item|Google Cloud|AWS|note|
|----|----|----|----|
|Build ã®å®šç¾©|yaml|yaml|GitHub ã§ç®¡ç†|
|Docker ã®ä»£æ›¿|`mirror.gcr.io`|`Amazon ECR Public Gallery Docker` [^3]||
|ç’°å¢ƒå¤‰æ•°|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾© [^4]|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾© [^5]||
|æ¨©é™ã¨æ¨©é™ã®ä»˜ä¸|åŸºæœ¬çš„ã« Default Google Service Account ã«æ¨©é™ã‚’ä»˜ä¸|IAM||

### Point ğŸ’¡
- DockerHub ã® rate limit [^2] ã«å¼•ã£ã‹ã‹ã‚‹ãŸã‚ã€ `Amazon ECR Public Gallery Docker` [^3] ã«å¤‰æ›´ã€‚

https://github.com/danny-yamamoto/rust-api-samples-axum/blob/30cf65f6922bf813bb2b4855a19731d839ea6177/Dockerfile#L2-L3

https://github.com/danny-yamamoto/rust-api-samples-axum/blob/30cf65f6922bf813bb2b4855a19731d839ea6177/Dockerfile#L32-L33

## About Amazon Elastic Container Registry (ECR)
![alt text](/images/188563c93c3a2a-d.png)
- Artifact Registry ã«ä¼¼ãŸã‚µãƒ¼ãƒ“ã‚¹ã€‚

## About ECS
![alt text](/images/188563c93c3a2a-e.png)
- Cloud Run ã«ä¼¼ãŸã‚µãƒ¼ãƒ“ã‚¹ã€‚
- ã€Œã‚¿ã‚¹ã‚¯ã€ã¨ã€Œã‚µãƒ¼ãƒ“ã‚¹ã€ã¸ã®ç†è§£ãŒå¿…è¦ã€‚

```bash
yamamotodaisuke@yamamotodaisukenoMacBook-Air zenn-docs % curl -i 44.x.x.x                              
HTTP/1.1 200 OK
content-type: application/json
content-length: 31
date: Wed, 27 Mar 2024 02:36:35 GMT

[{"user_id":1},{"user_id":999}]%                                                                                                                                                      
yamamotodaisuke@yamamotodaisukenoMacBook-Air zenn-docs %
```

![alt text](/images/188563c93c3a2a-b.png)

### Point ğŸ’¡
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­å®š:
    - ECS Fargate ã‚¿ã‚¹ã‚¯ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚°ãƒ«ãƒ¼ãƒ—ã¨ RDS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚°ãƒ«ãƒ¼ãƒ—ã«ãŠäº’ã„ã®é€šä¿¡ã‚’è¨±å¯ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚
    - å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã‚’è¨±å¯ã™ã‚‹ inbound/outbound ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚
        - `ã‚¿ã‚¤ãƒ—`: PostgreSQL
        - `ãƒ—ãƒ­ãƒˆã‚³ãƒ«`: TCP
        - `ãƒãƒ¼ãƒˆç¯„å›²`: 5432

## BTW
ã‚‚ã†ã™ãã§æœ‰çµ¦æ¶ˆåŒ–æœŸé–“ãŒçµ‚ã‚ã‚‹

èµ·åºŠã—ã¦ runningã€‚ã‚«ãƒ•ã‚§ã§ programming ã—ã¤ã¤ã€å¤•é£Ÿä½œã‚Šã‚„æ´—æ¿¯ã€æƒé™¤ã€å¡¾ã®é€è¿ã‚’ã™ã‚‹æ¯æ—¥

ç¤¾ä¼šæ€§ã®å‹•ç‰©ã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜ã—ãŸ

ä»•äº‹ãŒç„¡ã„ã¨äººã¨ã®é–¢ã‚ã‚ŠãŒè–„ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

ã‚ˆã‚Šå¤§äº‹ã«ã™ã‚‹ã¹ãã“ã¨ã¯ä½•ã‹ã‚’è€ƒãˆã•ã›ã‚‰ã‚ŒãŸ

ã¾ã•ã«ã€Œäººç”Ÿå¾ŒåŠã®æˆ¦ç•¥æ›¸ã€ã®ã¨ãŠã‚Š

https://www.sbcr.jp/product/4815618476/

[^1]: https://aws.amazon.com/jp/ecs/
[^2]: https://docs.docker.com/docker-hub/download-rate-limit/
[^3]: https://gallery.ecr.aws/docker
[^4]: https://cloud.google.com/build/docs/configuring-builds/substitute-variable-values?hl=ja
[^5]: https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/taskdef-envfiles.html
[^6]: https://cloud.google.com/build/docs/configuring-builds/create-basic-configuration?hl=ja
