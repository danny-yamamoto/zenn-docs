---
title: "Agentspace アプリの日本語化"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["agentspace", "ai", "llm", "googlecloud", "agentengine"]
published: false
---

![japanease](/images/807bb7d120efd8-a.png)

## tl;dr

- Agentspace アプリに日本語で質問すると、英語での回答になります。
- 日本語での回答を強制するためのに `instruction` に日本語を強制するプロンプトを追加します。

## はじめに

この blog では、Agentspace を使用したエージェント開発について書きます。AI エージェントの開発環境は日々進化しており、適切なツールとフレームワークの選択が開発の効率と品質に影響すると考えています。

今回は、Agentspace の Tips を紹介します。

Agentspace の Custom Agent については、以下の blog を参考にしてください。

## Agentspace アプリの日本語化

### 事象

![english](/images/807bb7d120efd8-b.png)

Agentspace に登録した Custom Agent に日本語で質問すると、英語での回答になりました。

いくつかのパターンで試してみましたが、結果は以下の通りでした。

- `adk run` コマンドを使用してローカルでアプリを起動した場合は、日本語で回答するようになります。
- Agent Engine Runtime にデプロイしたエージェントにクエリを送信すると、日本語での回答が得られます。
- Agentspace アプリ経由で Agent Engine に日本語で質問すると、英語での回答になります。

### 原因

> Please allow me to confirm that AgentSpace is a managed runtime environment in the cloud. It's designed for consistency, which means it might not automatically pass user-specific local information to the agent's prompt. Without a direct instruction, the agent may revert to a default behavior, such as responding in English, which is the most common language for AI model training and output.
>
> AgentSpaceはクラウド上の管理型実行環境であることを確認させていただきます。この環境は一貫性を重視して設計されており、ユーザー固有のローカル情報をエージェントのプロンプトに自動的に渡さない場合があります。直接的な指示がない場合、エージェントはデフォルトの動作に戻り、例えば英語で応答する可能性があります。これは、AIモデルのトレーニングと出力において最も一般的な言語であるためです。

サポート回答は上記の通りでした。日本語での回答を強制する必要があるようです。

### 対策

日本語での回答を強制するには、以下の手順を実行してください。

1. `agent.py` ファイルを開きます。
1. `instruction` を確認します。`prompt.py` で定義されているプロンプトを参照してください。
1. 日本語での回答を強制するために、以下のように `prompt.py` を修正します。
以下の 2 行を追加しました。
`IMPORTANT: Always respond in Japanese (日本語で回答してください).`
`- All explanations, questions, and feedback must be in Japanese.`
    ```python
    BASE_PROMPT = """
    You are a helpful Python programming tutor. Your job is to help students learn about Python dictionaries.

    IMPORTANT: Always respond in Japanese (日本語で回答してください).

    INSTRUCTIONS:
    - Guide users through Python dictionaries with key concepts and examples.
    - Format code examples using markdown code blocks.
    - Use lots of friendly emojis in your responses, including for formatting.
    - Be encouraging and provide detailed explanations for incorrect answers.
    - All explanations, questions, and feedback must be in Japanese.

    CURRENT SESSION STATE:
    - Current question index: {current_question_index}
    - Questions answered correctly: {correct_answers}
    - Total questions answered: {total_answered}
    - Current score: {score_percentage}%
    - Quiz started: {quiz_started}
    """
    ```
1. アプリを再デプロイします。
これで、Agentspace アプリは日本語で回答するようになります。

## Closing

「リーダブルコード」を読みました。何度かパラパラ読んだことはありますが、真剣に読んだのは初めてです。非常に良い本だと思います。特に、コードの可読性を高めるための具体的なテクニックは印象的でしたし、実践することで自分のコードも改善できると感じました。「リーダブルコード」を読んだきっかけは、安野さん（チームみらい）が自身のバイブルとして紹介されていたからです。また、彼が起業した企業の1つであるMNTSQ社のカジュアル面談を受けたことも彼に興味を持った理由の1つです。その動画を起点に他の動画を見ていくうちに、彼の話を聞いていると、僕の知っているリーダー像と大きく違っていることに気づかされました。僕の知る組織の中のリーダーは強烈なリーダーシップを発揮しており、メンバーを引っ張っていく存在です。ビジョナリー型のリーダーシップです。安野さんのリーダーシップはサーバントリーダーシップ型に近いと感じました。生成 AI の進化による変化の激しい現代において、仮説を立てて実験し学ぶことの重要性を感じています。そんな時代のリーダーとして、面白い存在だなと思いました。
