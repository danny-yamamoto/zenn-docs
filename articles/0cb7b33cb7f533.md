---
title: "Litestream"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Litestream", "rust", "googlecloud"]
published: false
---
Litestream ã¨ Rust ã«ã¤ã„ã¦ã€‚

https://litestream.io/

> Stop building slow, complex, fragile software systems. Safely run your application on a single server.
Fully-replicated database with no pain and little cost.
> 
> é…ãã¦è¤‡é›‘ã§å£Šã‚Œã‚„ã™ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰ã¯ã‚‚ã†ã‚„ã‚ã¾ã—ã‚‡ã†ã€‚å˜ä¸€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®‰å…¨ã«å®Ÿè¡Œã§ãã¾ã™ã€‚
å®Œå…¨ã«è¤‡è£½ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã€æ‰‹é–“ã‚‚ã‚³ã‚¹ãƒˆã‚‚ã‹ã‘ãšã«åˆ©ç”¨ã§ãã¾ã™ã€‚

Litestream ã¯ SQLite ã‚’è¤‡è£½ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã€‚

ä»¥å‰ Rust ã¨ SQLite ã§ API ã‚’ä½œæˆã—ãŸã€‚ã“ã® API ã« Litestream ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ã£ã¦ã¿ã‚‹ã€‚

æ§‹æˆã¯æ¬¡ã®ã¨ãŠã‚Šã€‚ğŸ

```mermaid
flowchart TD
    client
    subgraph gcs[Cloud Storage]
    generations
    end
    db1[(SQLite)]
    stream[Litestream]
    subgraph api[API]
    handler-->db1
    stream-->db1
    end
    client-- POST -->handler
    handler-- HTTP Status -->client
    stream-->generations
```

## Create Container
- Cloud Run ã®å ´åˆã€PORT `8080` ã¨ HOST `0.0.0.0` ã«æ°—ã‚’ä»˜ã‘ã‚‹ã€‚æ¯å›ãã“ã§ error ã«ãªã‚‹ã€‚
- Litestream ã® binary ã‚’è¿½åŠ ã€‚
- `litestream replicate` ã® background ã§ API ã‚’èµ·å‹•ã€‚

## Deploy
- Cloud Run ã« deploy ã™ã‚‹ã€‚

## Check the replicate
- Create method ã‚’è¿½åŠ ã™ã‚‹ã€‚

- API ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
- bucket ã«ã¯ generations folder ãŒä½œæˆã•ã‚Œã‚‹ã€‚
