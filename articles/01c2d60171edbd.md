---
title: "BPaaS が AWS Amplify Gen 2 を選択する理由"
emoji: "💡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["typescript", "amplify", "aws", "cdk", "nestjs"]
published: false
---

kubell Advent Calendar 2024 の投稿です。

https://qiita.com/advent-calendar/2024/kubell

2024年7月1日、Chatwork株式会社は株式会社kubellへと社名変更しました。

この投稿では、BPaaS が AWS Amplify Gen 2 (Amplify) を選択した理由について書きます。

## tl;dr
- Amplify を選定した理由は、開発効率とスピード向上のため
- AWS サービスとのネイティブ統合で認証やデータベース設定が簡単
- 自動ビルド・デプロイ機能により迅速な開発とリリースが可能
- 柔軟な環境管理でチームの要件に適合

## 前提

### BPaaS サービス

チャット経由で会計、労務、総務など様々なバックオフィス業務をアウトソースできる「Chatwork アシスタント」などのサービスです。

https://assistant.chatwork.com/?adcode=orgic_platf_cwassistant_gm-om_corporate&utm_source=gm-om&utm_medium=corporate&utm_campaign=cwassistant&utm_term=non&utm_content=cid25

### 市場志向のチーム
私たちは市場志向のチームであり、スピード感を持ってプロダクトを構築しています。

### スキルスタック

- 私たちのスキルスタックは TypeScript で、フロントエンド・バックエンド・インフラを含めフルスタック TypeScript がチームの方向性として合致していました。
- Amplify は AWS CDK でインフラを構築でき、TypeScript との親和性が高いです。
    - 私自身の経験としても、CDK for Terraform を使用して構築した経験があり、前職での経験が Amplify に対応しやすいものとなっていました。

### チーム状況

私たちがチームを構築したのは最近で、Developer は多くありません。そのため、効率的に開発を進める必要がありました。

## Amplify を選定した理由

### 開発効率とスピードの向上

市場志向のチームとして、開発効率とスピードの向上という明確な理由があります。Amplify は、AWS の各種サービス、特に認証やデータベースとのネイティブな統合が特徴です。この統合のおかげで、複雑な設定をせずに、簡単に安全でスケーラブルなアプリに加え、認証機能やストレージを利用することができます。

### フロントエンドとバックエンドの迅速な接続

Amplify の選定により、フロントエンドとバックエンドを迅速に接続し、必要な機能を短期間で構築できることが大きな利点だと思います。

### バックエンドの技術スタック選定

バックエンドは NestJS を選定しました。この選択により、フロントエンド・バックエンドどちらも開発することができ、メンバーの作業負荷状況に合わせて、フロントエンド・バックエンドに移動しながら開発できます。

### ホスティングと自動デプロイ

- 例えば、ユーザー認証機能を実装する際、Cognito との統合によりセキュリティ要件をクリアするのが比較的容易です。また、Amplify DataStore を使用してリアルタイムに同期可能なストレージを実現することも可能で、データの扱いを非常にシンプルできます。
- Amplify はホスティングの面でも強力です。

### 環境管理の柔軟性

- GitHub と連携して自動的にビルドやデプロイを行う機能があり、開発チーム全体のフローを円滑にする役割を果たしています。
- 特に私たちのように素早いプロダクト リリースとフィード バックサイクルを重視しているチームにとって、Amplify の自動デプロイ機能は非常に魅力的です。
- Amplify Console の利用により、異なるブランチを異なる環境（例えば Staging や Production）に割り当てることができるため、環境ごとのテストや確認がスムーズに行えます。

### プラグインアーキテクチャの活用

Amplify が持つプラグイン アーキテクチャにより、必要に応じて他の AWS サービスを組み合わせることができ、柔軟なシステム設計が可能です。

## 課題

### `ampx` コマンドのエラー解析の難しさ

- `ampx` コマンドでデプロイ時に発生するエラーから原因を特定するのはその時点では難しいと感じられました。
- `cdk` の警告や stacktrace は、 `ampx` と比較して多くの情報を与えてくれます。

### Stateful な構成要素の扱い

- Database などの Stateful な構成要素は変更が必要なタイミングが限られており、アプリケーションのデプロイサイクルとは異なっていました。原理的にはカスタム リソースを用いれば、Database を含め Amplify で構成することも可能でした。私がサポートに確認した時点では、サポートの見解も同様でした。しかし、最終的にカスタムリソースの全面的な採用は断念しました。


記事は以上です。

この投稿をみていただい方はいいねをお願いします。

それでは次回のアドカレでお会いしましょう👋
