---
title: "Recap Terraform: Import blocks"
emoji: "⚙️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["terraform", "googlecloud"]
published: false
---
Terraform について recap する。個人的な memo として。

まずは、Terraform v1.5.0 で追加された `Import` blocks について。

https://www.hashicorp.com/blog/terraform-1-5-brings-config-driven-import-and-checks

## before v1.5.0
### Plan and apply an import
インポートするには、以下の手順が必要。
1. `/modules/gcs` を準備。
1. `terraform import` で `.tfstate` を更新。
1. `terraform plan` で差分を確認。
1. HCL を調整。

```bash
.
├── environments
│   └── dev
│       ├── backend.tf
│       ├── main.tf       # edit
│       └── variables.tf
├── modules
│   └── gcs
│       ├── locals.tf     # add
│       ├── main.tf       # add
│       └── variables.tf  # add
└── README.md
```

```go: /modules/gcs/main.tf
resource "google_storage_bucket" "default" {
    project         = var.project_id
    name            = local.uploader_bucket_name
    location        = var.default_region
    force_destroy   = false
}

resource "google_storage_bucket_iam_binding" "object_admin" {
    bucket      = google_storage_bucket.default.name
    role        = "roles/storage.objectAdmin"
    members     = [for account in var.service_accounts : "serviceAccount:${account}"]
}
```

```go:/environments/dev/main.tf
module "hoge_bucket" {
  source = "../../modules/gcs"

  project_id        = var.project_id
  default_region    = var.region
  service_accounts  = var.service_accounts

  depends_on = [
    module.iam
  ]
}
```

- `hogebucket` は bucket name。
```bash: import
terraform import module.uploader_bucket.google_storage_bucket.default hogebucket
```

## v1.5.0 and later

## BTW
認知的変化について考える。

認知的変化 ≒ 学習

engineer それぞれの状態が異なるため、自分と同じことを求めることはできない。

その場合にどう言う選択をすることが良いのか。

自分に適した場所を探すのが1つの方法だと個人的に思う。

人生は一度しかない。
