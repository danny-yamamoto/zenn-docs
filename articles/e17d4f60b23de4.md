---
title: "(WIP)ADOT を使用して Next.js を計測する"
emoji: "📐"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["otel", "nextjs", "aws", "adot", "trace"]
published: false
---

kubell Advent Calendar 2024 の投稿です。

:::message
2024年7月1日、Chatwork株式会社は株式会社kubellへと社名変更しました。
:::

https://qiita.com/advent-calendar/2024/kubell

この投稿では、AWS Distro for OpenTelemetry (ADOT) を用いた Next.js の計測について書きます。

## tl;dr

Render の Tracing に ADOT を使用した
ADOT は AWS が配布している Otel collector
ECS で ADOT を起動した
ECS で Health Check を行うために config.yaml の修正が必要だった
ローカルで ADOT を起動するためには AWS の credentials が必要だった
Tracing と連携するために必要な権限は以下の通りだった
Render の実装は Vercel の Docs の通りだった
Vercel に Hosting しない場合は Custom が必要だった
Full Stack TypeScript のため、Render のコードの修正やテストが比較的容易だった
Backend の場合は Sidecar として起動できる。ECS の場合、config.yml はそのまま使える。`localhost` でアクセスできるため。
