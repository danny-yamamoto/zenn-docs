---
title: "Self-hosted GitHub Actions runners in AWS CodeBuild"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["actions", "github", "codebuild"]
published: true
---

Actions ã«ã¤ã„ã¦ã€‚

https://aws.amazon.com/jp/about-aws/whats-new/2024/04/aws-codebuild-managed-github-action-runners/

https://aws.amazon.com/jp/blogs/devops/aws-codebuild-managed-self-hosted-github-action-runners/

CodeBuild ãŒã‚µãƒãƒ¼ãƒˆé–‹å§‹ã—ãŸã¨ã„ã†ã“ã¨ã§è©¦ã™ã€‚

Trigger ã®è¨­å®šãŒæ©Ÿèƒ½ã™ã‚‹ã®ã‹ãŒç¢ºèªã—ãŸã„ãƒã‚¤ãƒ³ãƒˆã€‚filter ã§ build ã®èµ·å‹•ã‚’åˆ¶å¾¡ã—ãŸã„ã€‚

## tl;dr

- filter ã®å‹•ãã¯æ¤œè¨¼ä¸­ã€‚æ­£å¸¸ã«å‹•ã„ã¦ã„ã‚‹å ´åˆã¨ã€æ€ªã—ã„å ´åˆãŒã‚ã‚‹ã€‚è¦çµŒéè¦³å¯Ÿã€‚
- ãã®ä»–ã® Actions è‡ªä½“ã®å‹•ä½œã«é•å’Œæ„Ÿã¯ãªã„ã€‚

## CodeBuild ã¨ã®é€£æº

### Workflow

- `runs-on` [^4] ã®è¨­å®šå¤‰æ›´ãŒå¿…è¦ã€‚
    - `myProject` ã®éƒ¨åˆ†ã« build project name ã‚’è¨­å®šã™ã‚‹ã€‚Actions ã¨é€£æºã™ã‚‹ build project ã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜ã•ã›ã‚‹ã€‚
    - ã“ã‚ŒãŒé–“é•ã£ã¦ã„ã‚‹ã¨ã€GitHub å´ã® Webhook ãŒå¤±æ•—ã™ã‚‹ã€‚

```yaml
name: Hello World
on: [push]
jobs:
  Hello-World-Job:
    runs-on: codebuild-myProject-${{ github.run_id }}-${{ github.run_attempt }}    # Add
    steps:
      - run: echo "Hello World!"
```

### ãƒ—ãƒƒã‚·ãƒ¥ãŒç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å ´åˆã«ã®ã¿ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ [^3]

- Actions ã®å®Ÿè¡Œå±¥æ­´ã‚’è¦‹ã‚‹é™ã‚Šã€ `paths` filter ã«æŒ‡å®šã—ã¦ã„ã‚‹ã‚‚ã®ã«åå¿œã—ã¦ã„ã‚‹ã€‚
- `branches` filter ã‚’è¿½åŠ ã—ã¦æ§˜å­ã‚’è¦‹ã‚‹ã€‚

### Console

- `WORKFLOW_JOB_QUEUED` ã‚’é¸æŠã™ã‚‹ã€‚

![webhook event](/images/d44d9a52d7fc32-a.png)

## Conclusion

9é€£ä¼‘ã«çªå…¥ã—ãŸã€‚

ä¼šç¤¾ã®æœ‰çµ¦å–å¾—ç¾©å‹™ã‚’æº€ãŸã™ãŸã‚ã‚„ã‚€ã‚’å¾—ãšã€‚

æš‡ãªã®ã§ã€ä¼‘ã¿ä¸­ã«èª­ã‚ã‚‹æœ¬ã‚’æ¢ã—ã¦ã„ã‚‹ã€‚æœ€è¿‘ã“ã‚Œã¨ã„ã£ã¦èª­ã¿ãŸã„æœ¬ãŒç„¡ã„ã€‚

ã€Œãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–å®Ÿè·µã‚¬ã‚¤ãƒ‰ã€ã«èˆˆå‘³ãŒã‚ã‚‹ãŒã€è²·ã†å‰ã«ä¸­èº«ã«å°‘ã—ç›®ã‚’é€šã—ãŸã„æ°—æŒã¡ã‚‚ã‚ã‚‹ã€‚

https://www.shoeisha.co.jp/book/detail/9784798172354

ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã‚’ã¯ã˜ã‚ã‚ˆã†ã€ã«ã‚‚èˆˆå‘³ãŒã‚ã‚‹ã€‚ã“ã¡ã‚‰ã¯ã€æ„è¨³ãŒå¼·ã™ãã¦ã€ DDD ã§ã¯ãªãåˆ¥ç‰©ã«ãªã£ã¦ã„ã‚‹ã¨ã„ã†è©±ã‚’èãã€‚

https://www.oreilly.co.jp/books/9784814400737/

8æœˆæœ«ã«æ•°å†Šã€èˆˆå‘³ã®ã‚ã‚‹ã‚¿ã‚¤ãƒˆãƒ«ãŒç™ºå£²ã•ã‚Œã‚‹ãŸã‚ã€ãã‚Œã‚’å¾…ã¦ã¨ã„ã†è©±ã§ã¯ã‚ã‚‹ã€‚

[^3]: https://docs.github.com/ja/actions/writing-workflows/choosing-when-your-workflow-runs/events-that-trigger-workflows#running-your-workflow-only-when-a-push-affects-specific-files
[^4]: https://docs.github.com/ja/actions/writing-workflows/choosing-where-your-workflow-runs/choosing-the-runner-for-a-job
