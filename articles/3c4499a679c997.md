---
title: "yamory ã§ monorepo ã‚’ç®¡ç†ã™ã‚‹"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["yamory", "monorepo", "githubactions", "typescript"]
published: false
---

`yamory` ã§ monorepo ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦æ›¸ãã€‚

## Introduction

ç¾è·ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ã¯ã€monorepo ã§è¤‡æ•°ã® TypeScript ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã€‚ã”å­˜çŸ¥ã®é€šã‚Š monorepo ã§ã¯ã€è¤‡æ•°ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä¾å­˜é–¢ä¿‚ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹ã€‚`yamory` ã§ monorepo ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãŸã‚ã«ã¯ã€ã„ãã¤ã‹ã®è¨­å®šãŒå¿…è¦ã«ãªã‚‹ã€‚ä»Šå›ã¯ã€monorepo ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚ã‚’è§£æã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã€‚

## tl;dr

- monorepo ã®å ´åˆã¯ `package.json` ãŒè¤‡æ•°å­˜åœ¨ã™ã‚‹ãŸã‚ã€`yamory` ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãŸã‚ã«ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
- GitHub Actions ã§ monorepo ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

## Configuration

npm Workspaces [^1] ã§ monorepo ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã€‚ä»¥ä¸‹ã¯ã€monorepo ã®æ§‹æˆä¾‹ã§ã™ï¼š

```bash
.
â”œâ”€â”€ ./api
â”‚   â””â”€â”€ ./api/package.json
â”œâ”€â”€ ./load-testing
â”‚   â””â”€â”€ ./load-testing/package.json
â””â”€â”€ ./web-api-tests
    â””â”€â”€ ./web-api-tests/package.json
```

## yamory configuration

`yamory` ã§ monorepo ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ä»¥ä¸‹ã¯ã€monorepo ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ `yamory` ã‚’å®Ÿè¡Œã™ã‚‹ä¾‹ã§ã™ã€‚

```bash
PROJECT_GROUP_KEY=aou YAMORY_API_KEY=xxxxx YAMORY_OPEN_SYSTEM=true YAMORY_DISTRIBUTED=true bash -c "$(curl -sSf -L https://localscanner.yamory.io/script/npm)" -- --manifest ./api/package.json
```

## Scanning Automation

`yamory` ã§ monorepo ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ä»¥ä¸‹ã¯ã€GitHub Actions ã§ `yamory` ã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹ã§ã™ï¼š

```yaml
name: yamory Scan

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  # README at:
  # https://docs.github.com/ja/actions/writing-workflows/workflow-syntax-for-github-actions#example-of-onworkflow_callsecrets
  # https://zenn.dev/dzeyelid/articles/fc4bd999fbccd8
  api:
    uses: ./.github/workflows/reusable-yamory-scan.yml
    secrets:
      yamory_api_key: ${{ secrets.YAMORY_API_KEY }}
    with:
      project_group_key: api
      manifest_path: ./api/package.json
      environment: development
```

```yaml
name: Reusable yamory Scan

on:
  workflow_call:
    inputs:
      project_group_key:
        required: true
        type: string
      manifest_path:
        required: true
        type: string
      environment:
        type: string
        required: true
        default: 'development'
    secrets:
      yamory_api_key:
        required: true

jobs:
  yamory-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    environment: ${{ inputs.environment }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.8.0'

      # README at: https://docs.yamory.io/4e7c5078485249c8857bbed0191fe8a8
      - name: Run yamory scan
        run: |
          PROJECT_GROUP_KEY=${{ inputs.project_group_key }} YAMORY_API_KEY=${{ secrets.yamory_api_key }} YAMORY_OPEN_SYSTEM=true YAMORY_DISTRIBUTED=true bash -c "$(curl -sSf -L https://localscanner.yamory.io/script/npm)" -- --manifest ${{ inputs.manifest_path }}
```

[^1]: https://docs.npmjs.com/cli/v7/using-npm/workspaces
